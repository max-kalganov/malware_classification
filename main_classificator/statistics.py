from random import randint
from tqdm import tqdm
from torch import nn
import numpy as np
from main_classificator import ct
from main_classificator.classificator import ClassifArgs, pytorch_classification
from matplotlib import pyplot

from main_classificator.preprocessing.preproc_data import get_batch_num_by_label


def calc_best_alpha(name_of_fig: str):
    alphas = np.arange(0.001, 0.07, 0.001)
    accuracy_results = []
    classif_args = ClassifArgs(
        num_of_batches=65,
        hidden_layers=[(ct.MIN_WINDOW_SIZE, 100), (100, ct.NUM_OF_CLASSES)],
        criterion=nn.MSELoss(),
        l_rate=0.1,
        percent_of_tasks_to_train=1)

    get_in_train_for_stats = get_batch_num_by_label(num_of_samples_for_each=3)

    for i in tqdm(alphas):
        classif_args.l_rate = i
        # print(f" -- {i} -- ")
        accuracy_results.append(pytorch_classification(classif_args, full_train=False, predict=False,
                                                       get_in_train_for_stats=get_in_train_for_stats,
                                                       no_printing=True))

    pyplot.plot(alphas, accuracy_results)
    pyplot.savefig(ct.add_common_path(name_of_fig))
    pyplot.show()


if __name__ == '__main__':
    calc_best_alpha(name_of_fig="stats_for_alpha_001_07_correct.png")